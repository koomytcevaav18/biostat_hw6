---
title: "Kolomytseva_hw6"
author: "Kolomytseva"
date: "2024-04-10"
output: html_document
---

# ДЗ 6. Расчет выборки при планировании исследования

# Коломыцева Анна

Загрузка библиотек

```{r echo: false}
knitr::opts_chunk$set(
	message = FALSE,
	warning = FALSE,
	include = FALSE
)

library(tidyverse)
library(PowerTOST)
```

При выполнении этого домашнего задания вам необходимо посчитать выборки для различных типов точек. Напишите соответствующий код, пользуясь указанными формулами.

Пусть наш спонсор заинтересован, чтобы исследование имело 80% мощность, а уровень значимости — 5%, ожидаемый drop-out rate = 10%.

```{r}
alpha_ <- 0.05
drop_out_rate <- 0.10
beta_ <-  0.20
```

## Задание 1

Рассчитайте выборку для исследования терапевтической **эквивалентности** для двухпериодного *cross-over* дизайна. Из предыдущих исследований известно, что дисперсия составляет 20% ($\sigma_m = 0.20$), а разница средних составляет −10% ($\varepsilon = \mu_{test} - \mu_{reference}$). Клиницисты сообщают нам, что клинически значимая разница составляет 25% ($\delta = 0.25$).

Воспользуйтесь следующей формулой: $n_1=n_2=\frac{\left(Z_{\alpha / 2}+Z_\beta\right)^2 \sigma_m^2}{2 *(\delta-|\varepsilon|)^2}, n=n_1+n_2$

```{r}
sigma_m <- 0.20
delta_ <-  0.25
epsilon <-  -0.1

n1 <- TwoSampleCrossOver.Equivalence(
  alpha_, 
  beta_, 
  sigma_m, 
  delta_, 
  epsilon)

n <- (ceiling(n1)/(1 - drop_out_rate)) %>% ceiling() *2
sprintf("Размер выборки для исследования терапевтической эквивалентности для двухпериодного cross-over дизайна: %.f", n)

```

## Задание 2

Рассчитайте выборку для гипотезы **non-inferiority** для *двухвыборочного* параллельного дизайна. Пусть клинически значимая разница $\delta = -0.1$, то есть мы ожидаем разницу не меньше 10%, а долю ответов для тестового препарата $p_2 = 0.65$, в то время как нам известно из предыдущих исследований, что доля ответов у препарата сравнения составляет $p_1 = 0.85$. Соотношение групп равно $k = 1$.

Воспользуйтесь следующей формулой: $n_1=n_2=\frac{\left(Z_{\alpha / 2}+Z_\beta\right)^2\left(p_1*\left(1-p_1\right)+p_2*\left(1-p_2\right)\right)}{\left(p_1-p_2-\delta\right)^2}, n=n_1+n_2$

```{r}
delta_ <-  -0.1
p_1 <- 0.85
p_2 <- 0.65
k <- 1

n1 <- TwoSampleProportion.NIS(
  alpha_, 
  beta_, 
  p_1,
  p_2,
  delta_)

n <- (ceiling(n1)/(1 - drop_out_rate)) %>% ceiling() *2
sprintf("Размер выборки для гипотезы non-inferiority для двухвыборочного параллельного дизайна: %.f", n)
```

## Задание 3

Рассчитайте выборку для гипотезы **equality** для следующего исследования. Мы хотим сравнить новую терапию инфекции, присоединяющейся в больничных условиях у пациентов с ожогами, с золотым стандартом, основываясь на данных, анализируемых с помощью *регрессии Кокса*. Пусть отношение рисков «золотой стандарт / новая терапия», hazard ratio, HR = 2. Мы предполагаем, что 80% пациентов ($d = 0.8$) могут столкнуться с этим заболеванием. Соотношения групп терапии равны ($p_1=p_2=0.5$).

Воспользуйтесь следующей формулой: $n_1=n_2=\frac{\left(Z_{\alpha / 2}+Z_\beta\right)^2}{\ln (H R)^2 p_1 p_2 d}, n=n_1+n_2$

```{r}
HR <- 2
p_1 <- 0.5
p_2 <- 0.5
d <- 0.8

n1 <- Cox.Equality(
  alpha_, 
  beta_, 
  log(HR),
  p_1,
  d)

n <- (ceiling(n1)/(1 - drop_out_rate)) %>% ceiling() *2
sprintf("Размер выборки для гипотезы equality сравнения новой терапии с золотым стандартом с помощью регрессии Кокса: %.f", n)
```
